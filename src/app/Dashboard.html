<div class="panel mt-4 px-2 sm:px-6">
  <!-- Header -->
  <div class="mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
    <h5 class="text-base sm:text-lg font-semibold dark:text-white-light">
      Appointments Dashboard
    </h5>
    <div *ngIf="isLoading" class="flex items-center text-sm text-gray-500 dark:text-gray-400">
      <svg
        class="animate-spin h-4 w-4 mr-2 text-primary"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
        ></path>
      </svg>
      Loading...
    </div>
  </div>

  <!-- Tabs -->
  <div class="flex flex-wrap gap-2 mb-4 justify-center sm:justify-start">
    <button
      *ngFor="let tab of ['today', 'future', 'empty', 'conducted']"
      (click)="setActiveTab(tab)"
      [disabled]="isLoading"
      [ngClass]="{
        'bg-primary text-white': activeTab === tab,
        'bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300': activeTab !== tab
      }"
      class="px-4 py-1.5 sm:px-5 sm:py-2 text-sm rounded-md transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
    >
      {{ getTabLabel(tab) }}
    </button>
  </div>

  <!-- Table / Slot Container -->
  <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">

    <!-- ðŸŸ¦ EMPTY SLOTS CARD VIEW -->
    <div *ngIf="activeTab === 'empty'" class="p-4">
      <div *ngIf="filteredAppointments.length; else noData">
        <div
          class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4 justify-items-center"
        >
          <div
            *ngFor="let slot of filteredAppointments; let i = index"
            class="flex flex-col items-center justify-center bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all duration-300 w-full py-3 sm:py-4"
          >
            <div class="text-sm text-gray-400 dark:text-gray-500 mb-1">Slot {{ i + 1 }}</div>
            <div class="text-base sm:text-lg font-semibold text-gray-800 dark:text-gray-100">
              {{ slot.slot_time }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ðŸŸ© TABLE VIEW FOR OTHER TABS -->
    <table *ngIf="activeTab !== 'empty'" class="min-w-full text-sm sm:text-base">
      <thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
        <tr>
          <th class="px-2 py-2 text-left">#</th>
          <th class="px-2 py-2 text-left">Name</th>
          <th class="px-2 py-2 text-left hidden sm:table-cell">Mobile</th>
          <th class="px-2 py-2 text-left">Date</th>
          <th class="px-2 py-2 text-left hidden sm:table-cell">Slot</th>
          <th class="px-2 py-2 text-left hidden sm:table-cell">Price</th>
          <th
  *ngIf="activeTab !== 'conducted'"
  class="px-2 py-2 text-left"
>
  Status
</th>

          <th class="px-2 py-2 text-left">Actions</th>
        </tr>
      </thead>

      <tbody *ngIf="!isLoading && filteredAppointments.length; else noData">
        <tr
          *ngFor="let appt of filteredAppointments; let i = index"
          class="border-t border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition"
        >
          <td class="px-2 py-2">{{ i + 1 }}</td>
          <td class="px-2 py-2">
            <div class="flex flex-col">
              <span class="font-medium">{{ appt.name || '-' }}</span>
              <span class="text-xs text-gray-500 sm:hidden">{{ appt.mobile_number }}</span>
            </div>
          </td>
          <td class="px-2 py-2 hidden sm:table-cell">{{ appt.mobile_number || '-' }}</td>
          <td class="px-2 py-2">{{ appt.appointment_date | date: 'dd MMM yyyy' }}</td>
          <td class="px-2 py-2 hidden sm:table-cell">{{ appt.slot_time || '-' }}</td>
          <td class="px-2 py-2 hidden sm:table-cell">{{ appt.price ? ('â‚¹' + appt.price) : '-' }}</td>
         <td
  *ngIf="activeTab !== 'conducted'"
  class="px-2 py-2"
>
  <button
    (click)="toggleConducted(appt)"
    [ngClass]="{
      'bg-green-600 text-white': appt.is_appointment_conducted,
      'bg-yellow-500 text-white': !appt.is_appointment_conducted
    }"
    class="px-2 sm:px-3 py-1 rounded-md text-xs sm:text-sm transition-all"
  >
    {{ appt.is_appointment_conducted ? 'Conducted' : 'Pending' }}
  </button>
</td>

          <td class="px-2 py-2">
            <button
              (click)="openDetails(appt)"
              class="text-blue-500 text-xs sm:text-sm hover:underline"
            >
              View
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ðŸŸ¨ NO DATA TEMPLATE -->
  <ng-template #noData>
    <div class="text-center py-4 italic text-gray-400 dark:text-gray-500">
      No {{ getTabLabel(activeTab) }} appointments found
    </div>
  </ng-template>

  <!-- Appointment Details Modal -->
  <div
    *ngIf="selectedAppointment"
    class="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-3"
  >
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-md sm:max-w-lg p-5 relative">
      <button
        (click)="closePopup()"
        class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 dark:hover:text-white"
      >
        âœ•
      </button>

      <h3 class="text-lg font-semibold mb-3 dark:text-white">Appointment Details</h3>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-gray-700 dark:text-gray-300 text-sm">
        <div><strong>Name:</strong> {{ selectedAppointment.name }}</div>
        <div><strong>Mobile:</strong> {{ selectedAppointment.mobile_number }}</div>
        <div><strong>City:</strong> {{ selectedAppointment.city }}</div>
       
        <div><strong>Date:</strong> {{ selectedAppointment.appointment_date | date: 'dd MMM yyyy' }}</div>
        <div><strong>Slot:</strong> {{ selectedAppointment.slot_time }}</div>
        <div><strong>Type:</strong> {{ selectedAppointment.appointment_type }}</div>
        <div><strong>Status:</strong> {{ selectedAppointment.appointment_status }}</div>
        <div><strong>Price:</strong> â‚¹{{ selectedAppointment.price || '-' }}</div>
       
        <div><strong>Source:</strong> {{ selectedAppointment.source }}</div>
        <div><strong>Subjects:</strong> {{ selectedAppointment.subjects?.join(', ') || '-' }}</div>
      </div>

      <div class="mt-5 text-right">
        <button
          (click)="closePopup()"
          class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition text-sm sm:text-base"
        >
          Close
        </button>
      </div>
    </div>
  </div>

  <!-- ðŸ’° Price Update Modal -->
  <div
    *ngIf="priceModal.show"
    class="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-3"
  >
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-sm sm:max-w-md p-6 relative">
      <button
        (click)="closePriceModal()"
        class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 dark:hover:text-white"
      >
        âœ•
      </button>

      <h3 class="text-lg font-semibold mb-4 dark:text-white">Update Conduct Status</h3>

      <div class="space-y-3 text-sm sm:text-base">
        <div>
          <p class="text-gray-600 dark:text-gray-400 mb-1">
            Appointment Code: <strong>{{ priceModal.appointment?.appointment_code }}</strong>
          </p>
          <p class="text-gray-600 dark:text-gray-400">
            Current Status:
            <strong
              [ngClass]="{
                'text-green-600': priceModal.appointment?.is_appointment_conducted,
                'text-yellow-600': !priceModal.appointment?.is_appointment_conducted
              }"
            >
              {{ priceModal.appointment?.is_appointment_conducted ? 'Conducted' : 'Pending' }}
            </strong>
          </p>
        </div>

        <div>
          <label class="block text-gray-700 dark:text-gray-300 mb-1">Enter Price</label>
          <input
            type="number"
            [(ngModel)]="priceModal.price"
            placeholder="Enter price"
            class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white"
          />
        </div>

        <div class="flex justify-end gap-3 mt-4">
          <button
            (click)="closePriceModal()"
            class="px-3 py-1.5 rounded-md bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-200 hover:bg-gray-400 dark:hover:bg-gray-500 transition text-sm"
          >
            Cancel
          </button>
          <button
            (click)="confirmPriceUpdate()"
            class="px-3 py-1.5 rounded-md bg-green-600 text-white hover:bg-green-700 transition text-sm"
          >
            Update
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <p class="text-xs text-gray-400 dark:text-gray-500 mt-4 text-center">
    Â© 2025. MITECH All rights reserved
  </p>
</div>
